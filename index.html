<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu√© pongo hoy de com√© - Recetas con IA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #fcfcfc;
            color: #1a1a1a;
        }
        h1 {
            font-family: 'Playfair Display', serif;
        }
        .cuisine-chip.active {
            background-color: #1a1a1a;
            color: white;
            border-color: #1a1a1a;
        }
        .loader {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #1a1a1a;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            display: inline-block;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="min-h-screen p-6 md:p-12">

    <main class="max-w-2xl mx-auto">
        <!-- Header -->
        <header class="mb-12 text-center"> 
            <h1 class="text-4xl md:text-5xl mb-2">¬øVijen der Carmen, que pongo hoy de com√©?</h1>
            <p class="text-gray-500 font-light">ASISTENTE DE COCINA Y LA IA CHIVATA .</p>
        </header>

        <!-- Input Section -->
        <section class="mb-10">
            <label class="block text-sm font-semibold uppercase tracking-wider mb-3">¬øQu√© vemo comprado o que tengo por ah√≠ ?</label>
            <textarea 
                id="ingredientsInput" 
                class="w-full p-4 bg-white border border-gray-200 rounded-xl focus:ring-1 focus:ring-black focus:border-black outline-none transition-all resize-none h-32"
                placeholder="Ej: 2 huevos, un poco de arroz, tomate, cebolla..."
            ></textarea>
        </section>

        <!-- Cuisine Style Selection -->
        <section class="mb-10">
            <label class="block text-sm font-semibold uppercase tracking-wider mb-3">¬ø qu√© estilo vaquer√© soshete ?</label>
            <div class="flex flex-wrap gap-2" id="styleContainer">
                <button onclick="selectStyle('Mediterr√°nea', this)" class="cuisine-chip px-4 py-2 border border-gray-200 rounded-full text-sm hover:border-black transition-colors">Mediterr√°nea</button>
                <button onclick="selectStyle('Asi√°tica', this)" class="cuisine-chip px-4 py-2 border border-gray-200 rounded-full text-sm hover:border-black transition-colors">Asi√°tica</button>
                <button onclick="selectStyle('Mexicana', this)" class="cuisine-chip px-4 py-2 border border-gray-200 rounded-full text-sm hover:border-black transition-colors">Mexicana</button>
                <button onclick="selectStyle('Saludable/Fitness', this)" class="cuisine-chip px-4 py-2 border border-gray-200 rounded-full text-sm hover:border-black transition-colors">Saludable</button>
                <button onclick="selectStyle('R√°pida y f√°cil', this)" class="cuisine-chip px-4 py-2 border border-gray-200 rounded-full text-sm hover:border-black transition-colors">R√°pida</button>
                <button onclick="selectStyle('Gourmet', this)" class="cuisine-chip px-4 py-2 border border-gray-200 rounded-full text-sm hover:border-black transition-colors">Gourmet</button>
            </div>
        </section>

        <!-- Action Button -->
        <div class="text-center mb-16">
            <button 
                id="generateBtn"
                onclick="generateRecipe()"
                class="bg-black text-white px-8 py-4 rounded-full font-semibold hover:bg-zinc-800 transition-all disabled:bg-gray-400 flex items-center justify-center mx-auto"
            >
                <span id="btnText">A v√© que zale </span>
                <span id="btnLoader" class="loader ml-3 hidden"></span>
            </button>
        </div>

        <!-- Result Section -->
        <div id="resultContainer" class="hidden">
            <div id="recipeCard" class="bg-white border border-gray-100 shadow-sm p-8 rounded-2xl fade-in">
                <!-- Content will be injected here -->
            </div>
        </div>

        <!-- Message Box (Instead of Alert) -->
        <div id="messageBox" class="fixed bottom-10 left-1/2 -translate-x-1/2 bg-red-500 text-white px-6 py-3 rounded-full hidden shadow-lg transition-all">
            <span id="messageContent"></span>
        </div>
    </main>

    <script>
        const apiKey = "AIzaSyAk9GHLoNr03N_WklPr4VDxBPGqMl9f17I"; // La clave se proporciona autom√°ticamente en el entorno
        let selectedStyle = "";

        function selectStyle(style, element) {
            selectedStyle = style;
            document.querySelectorAll('.cuisine-chip').forEach(chip => chip.classList.remove('active'));
            element.classList.add('active');
        }

        function showMessage(text) {
            const box = document.getElementById('messageBox');
            const content = document.getElementById('messageContent');
            content.innerText = text;
            box.classList.remove('hidden');
            setTimeout(() => box.classList.add('hidden'), 4000);
        }

        async function fetchWithRetry(url, options, maxRetries = 5) {
            let delay = 1000;
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (response.ok) return await response.json();
                    if (response.status !== 429 && response.status < 500) break;
                } catch (e) {}
                await new Promise(res => setTimeout(res, delay));
                delay *= 2;
            }
            throw new Error('No se pudo obtener respuesta de la IA despu√©s de varios intentos.');
        }

        async function generateRecipe() {
            const ingredients = document.getElementById('ingredientsInput').value.trim();
            const btn = document.getElementById('generateBtn');
            const btnText = document.getElementById('btnText');
            const btnLoader = document.getElementById('btnLoader');
            const resultContainer = document.getElementById('resultContainer');
            const recipeCard = document.getElementById('recipeCard');

            if (!ingredients) {
                showMessage("Por favor, introduce alg√∫n ingrediente.");
                return;
            }

            if (!selectedStyle) {
                showMessage("Por favor, selecciona un estilo de cocina.");
                return;
            }

            // UI Loading State
            btn.disabled = true;
            btnText.innerText = "Cocinando ideas...";
            btnLoader.classList.remove('hidden');
            resultContainer.classList.add('hidden');

            const systemPrompt = `Eres un chef experto y creativo con un toque de humor andaluz (pero profesional). 
            Tu objetivo es crear una receta deliciosa basada estrictamente en los ingredientes proporcionados por el usuario. 
            Puedes asumir que el usuario tiene ingredientes b√°sicos de despensa (sal, aceite, pimienta, agua, az√∫car).
            
            Debes responder exclusivamente en formato JSON estructurado con el siguiente esquema:
            {
                "nombre": "Nombre creativo de la receta",
                "tiempo": "Tiempo estimado (ej: 25 min)",
                "dificultad": "Baja/Media/Alta",
                "ingredientes": ["ingrediente 1", "ingrediente 2"],
                "pasos": ["paso 1", "paso 2"],
                "consejo": "Un consejo √∫til del chef"
            }`;

            const userPrompt = `Ingredientes: ${ingredients}. Estilo de cocina deseado: ${selectedStyle}.`;

            try {
                const result = await fetchWithRetry(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: userPrompt }] }],
                        systemInstruction: { parts: [{ text: systemPrompt }] },
                        generationConfig: { 
                            responseMimeType: "application/json"
                        }
                    })
                });

                const rawText = result.candidates?.[0]?.content?.parts?.[0]?.text;
                const recipe = JSON.parse(rawText);

                renderRecipe(recipe);

            } catch (error) {
                console.error(error);
                showMessage("Uf, se nos ha quemado el arroz. Int√©ntalo de nuevo en un momento.");
            } finally {
                btn.disabled = false;
                btnText.innerText = "Generar mi receta";
                btnLoader.classList.add('hidden');
            }
        }

        function renderRecipe(recipe) {
            const resultContainer = document.getElementById('resultContainer');
            const recipeCard = document.getElementById('recipeCard');

            recipeCard.innerHTML = `
                <div class="flex justify-between items-start mb-6">
                    <div>
                        <h2 class="text-3xl font-bold mb-2">${recipe.nombre}</h2>
                        <div class="flex gap-4 text-xs uppercase tracking-widest text-gray-500">
                            <span>‚è±Ô∏è ${recipe.tiempo}</span>
                            <span>üî• ${recipe.dificultad}</span>
                        </div>
                    </div>
                </div>

                <div class="grid md:grid-cols-2 gap-8">
                    <div>
                        <h3 class="font-semibold mb-4 border-b pb-2">Ingredientes</h3>
                        <ul class="space-y-2 text-sm text-gray-700">
                            ${recipe.ingredientes.map(ing => `<li>‚Ä¢ ${ing}</li>`).join('')}
                        </ul>
                    </div>
                    <div>
                        <h3 class="font-semibold mb-4 border-b pb-2">Preparaci√≥n</h3>
                        <ol class="space-y-4 text-sm text-gray-700">
                            ${recipe.pasos.map((paso, index) => `
                                <li class="flex gap-3">
                                    <span class="font-bold text-gray-300">${index + 1}.</span>
                                    <span>${paso}</span>
                                </li>
                            `).join('')}
                        </ol>
                    </div>
                </div>

                <div class="mt-8 pt-6 border-t border-dashed border-gray-200">
                    <p class="text-sm italic text-gray-600">
                        <span class="font-bold">Consejo del chef:</span> ${recipe.consejo}
                    </p>
                </div>
            `;

            resultContainer.classList.remove('hidden');
            window.scrollTo({ top: resultContainer.offsetTop - 50, behavior: 'smooth' });
        }
    </script>
</body>
</html>